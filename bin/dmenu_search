#!/bin/bash
[ -z "$BROWSER" ] && BROWSER=surf
[ -z "$DMENU" ] && DMENU=dmenu

[ -z "$DIR_NAME" ] && DIR_NAME=~/.cache
[ -z "$FILE_NAME" ] && FILE_NAME=dmenu_search_history

mkdir -p $DIR_NAME
[ -f $DIR_NAME/$FILE_NAME ] || echo -e "suckless software\n" > $DIR_NAME/$FILE_NAME

[ -z "$SEARCH_ENGINE" ] && SEARCH_ENGINE="https://www.google.com/search?q="
[ -z "$SEARCH_ENGINE_YOUTUBE" ] && SEARCH_ENGINE_YOUTUBE="https://www.youtube.com/search?q="

search="$(sort -ur $DIR_NAME/$FILE_NAME | sed '/^$/d' | $DMENU -p search)"
echo "$search" >> $DIR_NAME/$FILE_NAME

search_engine="$SEARCH_ENGINE"
[ "$(echo $search | cut -d' ' -f1)" = "yt" ] && search_engine="$SEARCH_ENGINE_YOUTUBE"
[ "$(echo $search | cut -d' ' -f1)" = "yt" ] && search="$(echo $search | cut -d' ' -f2-)"

url="$search_engine$search"
[ -z "$search" ] || $BROWSER "$url"

